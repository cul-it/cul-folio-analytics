MCR217
Ematerial Title (instance) Counts

This query provides counts of ematerials, by format type. Formats are taken from 948 field, and if missing then taken
from the stat code, and if both these fields are missing, formats are taken from the MARC format code. Titles with 
multiple codes are assiged based on the priority listed in the CASE clause.
This query is primarily used to get counts for annual CUL reporting.
(This query has never removed titles on order.)


--Revised 12/20/25 to include joins to the records.lb table to exclude duplicate instance_ids due to a metadb glitch that is keeping some old as well as new record rows. 

--Adding the records.lb join to the subqueries would not allow the query to run as a whole, but the various sub-queries run without a problem, so this version of the query create tables in the metadb personal space, and the table with the final results can be exported as an Excel file directly from the personal schema. 

NOTE: To run this query, all the tables that are created need to be created in a personal space on Metadb. For example, in all the 'Create Table' statements, change 'z_vp25' to your personal space name. Each table has to created seperately; the query cannot be run as a whole. Run code for each 'Create Table' one at a time.
